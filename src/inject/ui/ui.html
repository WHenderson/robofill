<div ref:root>
    <div class="af-overlay" on:click="onCancel(event)" style="
        position: fixed;
        display: block;
        border: 0;
        margin: 0;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;

        opacity: 0.3;
        filter: alpha(opacity=30);
        background-color: #000;
        z-index: 9999;
    ">
    </div>
</div>

<script>
    import Postmate from 'postmate';
    import $ from 'jquery';

    export default {
        setup(AutoFill) {
        },
        data() {
            return {
            }
        },
        computed: {
        },
        oncreate() {
            const handshake = new Postmate({
                container: this.refs.root,
                url: this.get('script').src.replace(/(.*)\/inject\/index\.js(?:\?.*)?$/, '$1/spa/index.html')
            });
            const frame = $(this.refs.root).find('iframe').get(0);

            frame.style = `
                display: block;
                position: fixed;
                margin-left: auto;
                margin-right: auto;
                margin-top: 20px;
                left: 0;
                right: 0;
                top: 0;
                width: 640px;
                border: 1px solid black;
                opacity: 1.0;
                filter: alpha(opacity=100);
                background: #FFF;
                -webkit-box-shadow: 0px 0px 5px 5px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 0px 5px 5px rgba(0,0,0,0.75);
                box-shadow: 0px 0px 5px 5px rgba(0,0,0,0.75);
                z-index: 9999;
            `;

            this.set({ handshake, frame });

            handshake.then((child) => {
                this.set({ child });

                child.get('height').then(height => child.frame.style.height = `${height}px`);

                child.on('some-event', data => console.log('parent on some-event:', data));
            })
        },
        ondestroy() {
            // Destroy all evidence

            // Remove communication
            this.get('handshake').then(child => {
                child.destroy();
            });

            // Remove container
            this.options.target.remove();
        },
        methods: {
            onCancel() {
                this.destroy();
            }
        },
        events: {
        }
    };
</script>