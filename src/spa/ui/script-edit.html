<div class="ui form zingzing">

    <div ref:tabs class="ui pointing secondary menu">
        <a class="item active" data-tab="meta">Meta Data</a>
        <a class="item" data-tab="script">Script</a>
    </div>

    <div class="ui bottom attached tab segment active" data-tab="meta">
        <div class="field">
            <label>Name</label>
            <input type="text" placeholder="Script Name" bind:value="scriptEdit.name">
        </div>

        <div class="field">
            <label>Author</label>
            <input type="text" placeholder="Author Name" bind:value="scriptEdit.author">
        </div>

        <div class="field">
            <label>Description</label>
            <textarea type="text" placeholder="Script Description" bind:value="scriptEdit.description"/>
        </div>

        {{#if script.stamp}}
        <div class="field">
            <div class="ui label">
                <i class="calendar icon"></i>
                {{scriptEdit.stamp.replace(/^(.*)T.*$/, '$1')}}
                &nbsp;
                <i class="clock icon"></i>
                {{scriptEdit.stamp.replace(/^.*T(.*)$/, '$1')}}
            </div>
        </div>
        {{/if}}
    </div>
    {{#if scriptEdit.scriptItems}}
    <div class="ui bottom attached tab segment" data-tab="script">
        <ScriptItemsEdit ref:scriptItemsEditor bind:scriptItems="scriptEdit.scriptItems"/>
    </div>
    {{/if}}


    <div class="ui {{deepEqual(script,scriptEdit) ? 'disabled' : ''}} primary right floated button" on:click="fire('save', { script, scriptEdit, component: self })">
        <i class="save icon"></i>
        Save
    </div>
    <div class="ui {{deepEqual(script,scriptEdit) ? 'disabled' : ''}} negative button" on:click="fire('delete', { script, scriptEdit, component: self })">
        <i class="trash icon"></i>
        Discard
    </div>
    <div class="ui button" on:click="fire('new', { script, scriptEdit, component: self })">
        <i class="file icon"></i>
        New
    </div>
    <div class="ui button" on:click="fire('clone', { script, scriptEdit, component: self })">
        <i class="clone icon"></i>
        Clone
    </div>
</div>

<style>
    .ui.attached.segment {
        border: none;
        padding: 0;
    }

    ref:scriptSegments {
        overflow-y: scroll;
    }
</style>

<script>
    import ScriptItemsEdit from './script-items-edit.html'
    import deepEqual from 'deep-equal';

    const scriptDefaults = {
        name: '',
        description: '',
        stamp: '',
        author: '',
        scriptItems: []
    };

    export default {
        setup(Directive) {
        },
        data() {
            return {
                script: Object.assign({}, scriptDefaults),
                scriptEdit: Object.assign({}, scriptDefaults)
            }
        },
        helpers: {
            deepEqual
        },
        computed: {
        },
        oncreate() {
            $(this.refs.tabs).find('.item')
                .tab();

            this.set({ self: this });

            this.observe('script', script => {
                let scriptEdit = this.get('scriptEdit');
                if (!scriptEdit)
                    scriptEdit = Object.assign({}, scriptDefaults);

                if (!script)
                    script = {};

                for (const [k,v] of Object.entries(JSON.parse(JSON.stringify(script))))
                    scriptEdit[k] = v;

                this.set({ scriptEdit });
            });
        },
        ondestroy() {
        },
        methods: {
        },
        events: {
        },
        components: {
            ScriptItemsEdit
        }
    };
</script>