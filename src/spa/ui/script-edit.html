<div class="ui form">

    <div ref:tabs class="ui pointing secondary menu">
        <a class="item active" data-tab="meta">Meta Data</a>
        <a class="item" data-tab="script">Script</a>
    </div>

    <div class="ui bottom attached tab segment active" data-tab="meta">
        <div class="field">
            <label>Name</label>
            <input type="text" placeholder="Script Name" bind:value="script.name">
        </div>

        <div class="field">
            <label>Author</label>
            <input type="text" placeholder="Author Name" bind:value="script.author">
        </div>

        <div class="field">
            <label>Description</label>
            <textarea type="text" placeholder="Script Description" bind:value="script.description"/>
        </div>

        {{#if script.stamp}}
        <div class="field">
            <div class="ui label">
                <i class="calendar icon"></i>
                {{script.stamp.replace(/^(.*)T.*$/, '$1')}}
                &nbsp;
                <i class="clock icon"></i>
                {{script.stamp.replace(/^.*T(.*)$/, '$1')}}
            </div>
        </div>
        {{/if}}
    </div>
    <div class="ui bottom attached tab segment" data-tab="script">
        <ScriptItemsEdit ref:scriptItemsEditor scriptItems="{{script.scriptItems || []}}"/>
    </div>

    <div class="ui primary right floated button" on:click="fire('save', { script })">
        <i class="save icon"></i>
        Save
    </div>

    <div class="ui negative button" on:click="fire('delete', { script })">
        <i class="trash icon"></i>
        Delete
    </div>
    <div class="ui button" on:click="fire('new', { script })">
        <i class="file icon"></i>
        New
    </div>
    <div class="ui button" on:click="fire('clone', { script })">
        <i class="clone icon"></i>
        Clone
    </div>

</div>

<style>
    .ui.attached.segment {
        border: none;
        padding: 0;
    }

    ref:scriptSegments {
        overflow-y: scroll;
    }
</style>

<script>
    import ScriptItemsEdit from './script-items-edit.html'

    const scriptDefaults = {
        name: '',
        description: '',
        stamp: '',
        author: '',
        scriptItems: []
    };

    export default {
        setup(Directive) {
        },
        data() {
            return {
                script: Object.assign({}, scriptDefaults)
            }
        },
        helpers: {
        },
        computed: {
        },
        oncreate() {
            $(this.refs.tabs).find('.item')
                .tab();

            this.observe('script', script => {
                let changed = false;

                if (!script)
                    script = {};
                for (const [k,v] of Object.entries(scriptDefaults)) {
                    if (!{}.hasOwnProperty.call(script, k)) {
                        script[k] = v;
                        changed = true;
                    }
                }
                if (changed)
                    this.set({ script });
            })
        },
        ondestroy() {
        },
        methods: {
        },
        events: {
        },
        components: {
            ScriptItemsEdit
        }
    };
</script>