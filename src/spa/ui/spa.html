<div ref:root class="ui padded container">
    <form class="ui form">
        <h1 class="ui dividing header">RoboFill: Select Script</h1>

        <div class="field">
            <label for="upload">Upload Script:</label>
            <div class="ui fluid file input action">
                <input type="text" readonly>
                <input type="file" id="upload" name="files1" autocomplete="off" style="display:none">
                <div class="ui button">
                    Select...
                </div>
            </div>
        </div>

        <div class="field">
            <label>Select Script</label>
            <div ref:script class="ui fluid search selection dropdown">
                <input type="hidden" name="country">
                <i class="dropdown icon"></i>
                <div class="default text">Select Script</div>
                <div class="menu">
                    {{#each scripts as script, iscript}}
                    <div class="item" data-value="{{iscript}}" data-text="{{script.name}} : {{script.author}} : {{script.description}}">
                        <div class="ui items">
                            <div class="item">
                                <div class="content">
                                    <a class="header">{{script.name}}</a>
                                    <div class="meta">
                                        <span>{{script.stamp}}</span>
                                    </div>
                                    <div class="description">
                                        <p>{{script.description}}</p>
                                    </div>
                                    <div class="extra">
                                        <a class="ui teal label">{{script.author}}</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--
                    <div class="item" data-value="{{iscript}}" data-text="{{script.name}} : {{script.author}} : {{script.description}}">
                        <div>{{script.name}}</div>
                        <div>{{script.author}}</div>
                        <div>{{script.description}}</div>
                    </div>
                    -->
                    {{/each}}
                </div>
            </div>
        </div>
    </form>

    {{#if script}}
    <div class="ui raised segment">
        <div class="ui items">
            <div class="item">
                <div class="content">
                    <a class="header">{{script.name}}</a>
                    <div class="meta">
                        <a class="ui label">
                            <i class="calendar icon"></i>
                            &nbsp;
                            {{script.stamp.replace(/^(.*)T.*$/, '$1')}}
                            &nbsp;
                            &nbsp;
                            <i class="clock icon"></i>
                            &nbsp;
                            {{script.stamp.replace(/^.*T(.*)$/, '$1')}}
                        </a>
                    </div>
                    <div class="description">
                        <p>{{script.description}}</p>
                    </div>
                    <div class="extra">
                        <a class="ui teal ribbon label">{{script.author}}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{/if}}
</div>

<script>
    import Postmate from 'postmate';

    export default {
        setup(AutoFill) {
        },
        data() {
            return {
                scripts: [
                    { name: 'my name', author: 'my author', description: 'my description xxx', stamp: (new Date()).toISOString() },
                    { name: 'my lname', author: 'my mauthor', description: 'my ndescription zzz', stamp: (new Date()).toISOString() }
                ]
            }
        },
        computed: {
        },
        oncreate() {
            const handshake = new Postmate.Model({
                height: () => document.height || document.body.offsetHeight
            });
            this.set({ handshake });

            handshake.then((parent) => {
                this.set({ parent });

                parent.emit('some-event', 'Woot Woot');
            });

            $(this.refs.script).dropdown({
                fullTextSearch: true,
                ignoreCase: true,
                match: 'text',
                onChange: (iscript, text, $choice) => {
                    const scripts = this.get('scripts');
                    const script = (iscript >= 0 && iscript < scripts.length) ? scripts[iscript] : undefined;
                    this.set({ script });
                }
            });
            this.observe('script', (script) => {
                $(this.refs.script).dropdown('set selected', this.get('scripts').indexOf(script));
            });

        },
        ondestroy() {
        },
        methods: {
        },
        events: {
        }
    };
</script>